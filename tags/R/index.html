<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>标签: R - Taotao&#039;s Blog</title><meta description="Stay Hungry Stay foolish"><meta property="og:type" content="blog"><meta property="og:title" content="Taotao&#039;s Blog"><meta property="og:url" content="http://yoursite.com/"><meta property="og:site_name" content="Taotao&#039;s Blog"><meta property="og:description" content="Stay Hungry Stay foolish"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://yoursite.com/img/og_image.png"><meta property="article:author" content="Shebt"><meta property="article:tag" content="BioIT"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com"},"headline":"Taotao's Blog","image":["http://yoursite.com/img/og_image.png"],"author":{"@type":"Person","name":"Shebt"},"description":"Stay Hungry Stay foolish"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Taotao&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">标签</a></li><li class="is-active"><a href="#" aria-current="page">R</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-08-15T12:40:51.000Z" title="2020-08-15T12:40:51.000Z">2020-08-15</time><span class="level-item">1 小时 读完 (大约 7006 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/08/15/ggplot2/">ggplot2 基础理论知识</a></h1><div class="content"><p>主要内容参考<a href="https://www.bbsmax.com/A/kPzO8nNaJx/">bbsmax</a>  <a href="https://www.plob.org/article/10475.html">ggplot2入门与进阶</a></p>
<blockquote>
<p>ggplot2的核心理念是将绘图与数据分离，数据相关的绘图与数据无关的绘图分离 ggplot2是按<strong>图层</strong>作图 ggplot2保有命令式作图的调整函数，使其更具灵活性 ggplot2将常见的统计变换融入到了绘图中。 ggplot的绘图有以下几个特点：</p>
<p>第一，有明确的起始（以ggplot函数开始）与终止（一句语句一幅图）；</p>
<p>其二，图层之间的叠加是靠“+”号实现的，越后面其图层越高。</p>
<p>ggplot图的元素主要可以概括如下：最大的是plot（指整张图，包括background和title），其次是axis（包括stick，text，title和stick）、legend（包括backgroud、text、title）、facet这是第二层次，其中facet可以分为外部strip部分（包括backgroud和text）和内部panel部分（包括backgroud、boder和网格线grid，其中粗的叫grid.major，细的叫grid.minor）</p>
<p>ggplot2里的所有函数可以分为以下几类： </p>
<p>用于运算（我们在此不讲，如fortify_，mean_等） 初始化、展示绘图等命令（ggplot，plot，print等） 按变量组图（facet_等）</p>
<p><strong>真正的绘图命令（stat_，geom_，annotate），这三类就是实现一个函数一个图层的核心函数</strong> </p>
<p>微调图型：严格意义上说，这一类函数不是再实现图层，而是在做局部调整。 aes : 同样适用于修改geom_XXX() aes参数控制了对哪些变量进行图形映射，以及映射方式 图形属性（aes） 横纵坐标、点的大小、颜色，填充色等 </p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 完整公式总结</span></span><br><span class="line">ggplot(data = , aes(x = , y = )) + geom_XXX(<span class="keyword">...</span>) + <span class="keyword">...</span> + stat_XXX(<span class="keyword">...</span>) + <span class="keyword">...</span> + annotate(<span class="keyword">...</span>) + <span class="keyword">...</span> + labs(<span class="keyword">...</span>) + scale_XXX(<span class="keyword">...</span>) + coord_XXX(<span class="keyword">...</span>) + guides(<span class="keyword">...</span>) + theme(<span class="keyword">...</span>) + facet_XXX(<span class="keyword">...</span>)</span><br><span class="line"><span class="comment"># 例子</span></span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line"><span class="keyword">attach</span>(iris)</span><br><span class="line">p &lt;- ggplot(data=iris,aes(x = Sepal.Length,y = Sepal.Width))</span><br><span class="line">p + geom_point(aes(colour = Species)) + stat_smooth() + </span><br><span class="line">labs(title = <span class="string">"Iris of Sepal.length \n According to the Sepal.Width"</span>) +</span><br><span class="line">theme_classic() + theme_bw() +annotate(<span class="string">"text"</span>,x=<span class="number">7</span>,y=<span class="number">4</span>,parse = <span class="literal">T</span>,label = <span class="string">"x[1]==x[2]"</span>,size=<span class="number">6</span>, family=<span class="string">"serif"</span>,fontface=<span class="string">"italic"</span>, colour=<span class="string">"darkred"</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一张统计图形就是从数据到几何对象*<em>(geometric object,</em> <em>缩写为geom,</em> <em>包括点、线、条形等)**的图形属性(aesthetic attributes,缩写为aes, 包括颜色、形状、大小等)的一个映射。此外,</em> <em>图形中还可能包含数据的统计变换(statistical transformation,</em> <em>缩写为stats),</em> <em>最后绘制在某个特定的坐标系(coordinate system,</em>  <em>缩写为coord)**中,</em> <em>而分面(facet,</em> *指将绘图窗口划分为若干个子窗口)**则可以用来生成数据中不同子集的图形。 </p>
</blockquote>
<ol>
<li>数据(data)</li>
<li>映射(mapping) ： <code>aes()</code> </li>
<li>几何对象(geom) </li>
<li>标度(scale) : 将数据的取值映射到图形空间，如用颜色，大小，或形状表示不同的取值，常见做法是绘制图例和坐标轴，它们实际上是从图形到数据的映射</li>
<li>统计变换(stats)</li>
<li>坐标系(coord)</li>
<li>分面(facet)</li>
<li>主题(theme)</li>
<li>存储与输出</li>
</ol>
<h3 id="1-数据"><a href="#1-数据" class="headerlink" title="1.数据"></a>1.数据</h3><ul>
<li>数据必须为数据框，易于使用<code>transform()</code> <code>%+%</code> 转换</li>
<li><code>ggplot2</code> 数据分组必须根据行，而不是列，要求把宽数据转换为长数据</li>
</ul>
<h3 id="2-映射"><a href="#2-映射" class="headerlink" title="2.映射"></a>2.映射</h3><ul>
<li><p>aes(x= , y= ,color=)</p>
</li>
<li><p>映射与设定的区别，<strong>映射</strong>是将一个变量中离散或连续的数据与一个图形属性中以不同的参数来相互关联, 而<strong>设定</strong>能够将这个变量中所有的数据统一为一个图形属性 如 <code>geom_point(color=&quot;blue&quot;)</code></p>
</li>
<li><p>group()：分组</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p1 &lt;- ggplot(data = mtcars, mapping = aes(x = wt, y = hp)) + geom_line()</span><br><span class="line"><span class="comment">#默认分组设置, 即group=1</span></span><br><span class="line"><span class="comment">#geom_line为折线图的几何对象</span></span><br><span class="line">p2 &lt;- ggplot(data = mtcars, mapping = aes(x = wt, y = hp, group = factor(gear))) + geom_line()</span><br><span class="line"><span class="comment">#把wt和hp所对应的观测点按gear(gear以因子化变为离散变量)进行分组</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>图层中修改映射</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">p &lt;- ggplot(mtcars, aes(x = mpg, y = wt, color = factor(gear)))</span><br><span class="line"><span class="comment">#设定默认的映射关系</span></span><br><span class="line">p + geom_point()</span><br><span class="line"><span class="comment">#沿用默认的映射关系来绘制散点图</span></span><br><span class="line">p + geom_point(aes(shape = factor(carb)))</span><br><span class="line"><span class="comment">#添加图层中的shape的映射关系</span></span><br><span class="line">p + geom_point(aes(y = carb)))</span><br><span class="line"><span class="comment">#修改默认的y的映射关系, 注意图中y轴名称仍然以默认的wt表示</span></span><br><span class="line">p + geom_point(aes(color = <span class="literal">NULL</span>))</span><br><span class="line"> <span class="comment">#删除默认的color映射关系</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>图层叠加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mtcars.c &lt;- transform(mtcars, mpg &#x3D; mpg^2)</span><br><span class="line">#构建不同于mtcars的数据集mtcars.c</span><br><span class="line">#选用向量数据</span><br><span class="line">ggplot()+ geom_point(aes(x &#x3D; hp, y &#x3D; mpg), data &#x3D; mtcars, color &#x3D; &quot;red&quot;) + </span><br><span class="line">  geom_point(aes(x &#x3D; mtcars$hp, y &#x3D; mtcars$disp), color &#x3D; &quot;green&quot;)+ </span><br><span class="line">  geom_point(aes(x &#x3D; hp, y&#x3D; mpg), data &#x3D; mtcars.c, color &#x3D; &quot;blue&quot;)</span><br><span class="line">  #选用不同的数据集</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3-几何对象"><a href="#3-几何对象" class="headerlink" title="3.几何对象"></a>3.几何对象</h3><p>几何对象执行着图层的实际渲染, 控制着生成的图像类型 </p>
<p>geom_point()，geom_line()，geom_histogram()，geom_density()，geom_boxplot()，geom_text()/label()，geom_violin()</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">p &lt;- ggplot(mtcars, aes(wt, mpg))</span><br><span class="line">p + geom_point()</span><br><span class="line"><span class="comment">#更改颜色-连续变量</span></span><br><span class="line">p + geom_point(aes(color = qsec))</span><br><span class="line"><span class="comment">#更改颜色-离散变量</span></span><br><span class="line">p + geom_point(aes(color = factor(gear)))</span><br><span class="line"><span class="comment">#更改透明度</span></span><br><span class="line">p + geom_point(aes(alpha = qsec))</span><br><span class="line"><span class="comment">#更改形状</span></span><br><span class="line">p + geom_point(aes(shape = factor(gear)))</span><br><span class="line"><span class="comment">#更改点大小</span></span><br><span class="line">p + geom_point(aes(size = qsec))</span><br><span class="line"><span class="comment">#两种颜色的叠加</span></span><br><span class="line">p + geom_point(color = <span class="string">"grey50"</span>, size = <span class="number">5</span>) + geom_point(aes(color = qsec), size = <span class="number">4</span>)</span><br><span class="line"><span class="comment">#颜色和形状的叠加</span></span><br><span class="line">p + geom_point(color = <span class="string">"grey50"</span>, size = <span class="number">5</span>) + geom_point(aes(shape = factor(gear)), size = <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h3 id="4-统计变换"><a href="#4-统计变换" class="headerlink" title="4.统计变换"></a>4.统计变换</h3><p><strong>geom_histogram()**这个几何对象默认使用stat_bin这个统计变换, 将一维的数据分组，变成二维的，从而在xy坐标轴上画图。而这个统计变换会生成</strong>(1)count<strong>：每个组里观测值的数目, **(2)density</strong>：每个组里观测值的密度和(3)<strong>x</strong>：组的中心位置这三个变量。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">m &lt;- ggplot(movies, aes(rating)) </span><br><span class="line"><span class="comment">#这里使用movies数据集</span></span><br><span class="line">m + geom_histogram()</span><br><span class="line">m + geom_histogram(bin = <span class="number">0.5</span>)</span><br><span class="line"><span class="comment">#调整分箱(bin)数据</span></span><br><span class="line">m + geom_histogram(bin = <span class="number">1</span>)</span><br><span class="line">m + geom_histogram(bin = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h3 id="5-元素位置的调整"><a href="#5-元素位置的调整" class="headerlink" title="5.元素位置的调整"></a>5.元素位置的调整</h3><p>dodeg  fill  stack  jitter</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">d &lt;- ggplot(diamonds, aes(x = clarity, fill = cut )) + geom_histogram(stat=<span class="string">"count"</span>)</span><br><span class="line"><span class="comment"># 这里只设定了x的数据映射源，而没有指定y数据映射，而 stat="count"就默认设定了y的数据来源为 总数 ，position默认为 stack</span></span><br><span class="line">d + geom_histogram(stat=<span class="string">"count"</span>, position = <span class="string">"dodge"</span>)</span><br><span class="line"><span class="comment"># dodge：并排方式</span></span><br><span class="line">d + geom_histogram(stat=<span class="string">"count"</span>,position = <span class="string">"fill"</span>)</span><br><span class="line"><span class="comment"># fill : 堆叠，高度标准化为1</span></span><br><span class="line">d + geom_histogram(stat=<span class="string">"count"</span>,position = <span class="string">"stack"</span>)</span><br><span class="line"><span class="comment"># stack : 堆叠图像元素</span></span><br><span class="line">ggplot(diamonds) + geom_point(aes(color, price/carat), position = <span class="string">"jitter"</span>)</span><br><span class="line"><span class="comment"># jitter：给点增加扰动避免重合 ，每一个点在x轴的方向上产生随机的偏移, 从而减少了图形重叠的问题</span></span><br><span class="line"><span class="comment"># identity： 不做任何调整</span></span><br><span class="line"></span><br><span class="line">A &lt;- c(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>)</span><br><span class="line">B &lt;- c(<span class="number">2</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">ggplot() + geom_histogram(aes(x = A, y = B), stat = <span class="string">"identity"</span>)</span><br><span class="line"><span class="comment"># 声明stat="identity"固定Xy轴作图，不做统计变换，从这里也可以看到，其实画图可以在geom_histogram()中画，ggplot()搭个框架</span></span><br></pre></td></tr></table></figure>

<h3 id="6-平滑曲线"><a href="#6-平滑曲线" class="headerlink" title="6.平滑曲线"></a>6.平滑曲线</h3><p>geom_smooth()给数据添加平滑曲线, 所能采用的方法包括了<strong>lm, glm, gam, loess, rlm</strong>等, 这些方法需要通过加载公式来实现。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">m &lt;- ggplot(mtcars, aes(qsec, wt))</span><br><span class="line">m + stat_smooth() + geom_point()</span><br><span class="line">m + stat_smooth(se = <span class="literal">FALSE</span>) + geom_point()</span><br><span class="line"> <span class="comment">#取消默认的置信区间</span></span><br><span class="line">m + stat_smooth(fill = <span class="string">"red"</span>, size = <span class="number">2</span>, alpha = <span class="number">0.5</span>, color = <span class="string">"green"</span>) + geom_point()</span><br><span class="line"><span class="comment">#更改置信区间和线条颜色</span></span><br><span class="line">m + stat_smooth(method = <span class="string">"lm"</span>) + geom_point()</span><br><span class="line"><span class="comment">#用一元一次线性方程拟合</span></span><br><span class="line">m + stat_smooth(method = <span class="string">"lm"</span>, formula = y ~ poly(x, <span class="number">3</span>)) + geom_point()</span><br><span class="line"><span class="comment">#使用一元二次方程拟合</span></span><br><span class="line"><span class="keyword">require</span>(splines)</span><br><span class="line"><span class="keyword">require</span>(MASS)</span><br><span class="line">m + stat_smooth(method = <span class="string">"lm"</span>, formula = y ~ ns(x, <span class="number">3</span>)) + geom_point()</span><br><span class="line"><span class="comment"># 加载splines和MASS包, 使用自由度为3的自然样条来进行拟合</span></span><br><span class="line">m &lt;- ggplot(mtcars, aes(y = wt, x = mpg, group = factor(cyl)))</span><br><span class="line">m + stat_smooth(method = lm, aes(color = factor(cyl), fill = factor(cyl))) + geom_point( aes(color = factor(cyl)))</span><br><span class="line"><span class="comment">#按cyl这个离散变量进行分组, 分别拟合数据</span></span><br></pre></td></tr></table></figure>

<h3 id="7-标度"><a href="#7-标度" class="headerlink" title="7.标度"></a>7.标度</h3><p> <strong>标度</strong>控制着数据到图形属性的映射, 更重要的一点是标度将我们的数据转化为视觉上可以感知的东西, 如大小(size)、颜色(color,fill)、位置(position(x,y))、形状(shape)和线条类型(line type)。所以通过标度可以修改坐标轴和图例的参数。</p>
<blockquote>
<p>所有<strong>标度构建器(scale constructor)**都拥有一套通用的命名方案。它们以</strong>scale_<strong>开头, 接下来是</strong>图形属性的名称**(例如,  color_、shape_或x_)最后以<strong>标度的名称</strong>结尾(例如gradient、hue或manual)。从表中可以发现, <strong>标度是区分离散和连续变量的</strong>, 因此再对标度进行调整一定要注意区分。ggplot2中的标度可以粗略的分为4类：**(1)位置标度**:用于将连续型、离散型和日期-时间型变量映射到绘图区域, 以及构造对应的坐标轴; <strong>(2)颜色标度：</strong>用于将连续型和离散型变量映射到颜色; <strong>(3)手动离散型标度：</strong>用于将离散型变量映射到我们选择的符号大小、线条类型、形状或颜色, 以及创建对应的图例; 以及**(4)同一型标度：**用于直接将变量值绘制为图形属性, 而不去映射他们。 </p>
</blockquote>
<p>实际应用中修改标度最长用的有3个方面**(1)修改图例和(2)修改图形属性和(3)修改坐标轴** </p>
<h3 id="8-分面"><a href="#8-分面" class="headerlink" title="8.分面"></a>8.分面</h3><blockquote>
<p>即在一个页面上自动摆放多幅图形, 这一过程先将数据划分为多个子集, 然后将每个子集依次绘制到页面的不同面板中。ggplot2提供两种分面类型：<strong>网格型(facet_grid)**和</strong>封面型(facet_wrap)<strong>。</strong>网格<strong>分面生成的是一个</strong>2维<strong>的面板网格, 面板的行与列通过变量来定义, 本质是</strong>2维<strong>的; **封装</strong>分面则先生成一个<strong>1维</strong>的面板条块, 然后再分装到<strong>2维</strong>中, 本质是<strong>1维</strong>的 </p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p &lt;- ggplot(mtcars, aes(mpg, wt)) + geom_point()</span><br><span class="line">p + facet_grid(. ~ cyl) <span class="comment">#以cyl为分类变量</span></span><br><span class="line">p + facet_wrap( ~ cyl, nrow = <span class="number">3</span>) <span class="comment">#wrap与grid的区别</span></span><br><span class="line">p + facet_grid(cyl ~ .) <span class="comment">#以cyl为分类变量</span></span><br><span class="line">p + facet_wrap( ~ cyl, ncol = <span class="number">3</span>) <span class="comment">#wrap与grid的区别</span></span><br><span class="line">p + facet_grid(vs ~ am) <span class="comment">#以vs和am为分类变量</span></span><br><span class="line">p + facet_wrap(vs ~ am, ncol = <span class="number">2</span>) <span class="comment">#wrap与grid 的区别</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p &lt;- p + geom_smooth(method = <span class="string">"lm"</span>, se =<span class="literal">F</span>, aes(color = factor(cyl))) + geom_point(aes(color = factor(cyl)))</span><br><span class="line">p + facet_grid(vs ~ am)</span><br><span class="line">p + facet_grid(vs ~ am, margins = <span class="literal">T</span>) <span class="comment">#使用margins来描述边际图</span></span><br><span class="line">p + facet_grid( ~ cyl, scales = <span class="string">"free"</span>)</span><br><span class="line">p + facet_grid( ~ cyl, scales = <span class="string">"free_x"</span>) <span class="comment"># scale 可取 "fixed" "free" "free_x" "free_y" 坐标刻度的范围，可以设定四种类型。fixed 表示所有小图均使用统一坐标范围；free表示每个小图按照各自数据范围自由调整坐标刻度范围；free_x为自由调整x轴刻度范围；free_y为自由调整y轴刻度范围。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 例子有问题，cty, hwy不知道是什么</span></span><br><span class="line">p &lt;- ggplot(aes(cty, hwy), data = mtcars) + geom_point()</span><br><span class="line">p + facet_wrap( ~ cyl)</span><br><span class="line"><span class="comment">#调整scales的标度, 共有fixed, free, free_x和free_y四种变换</span></span><br><span class="line">p + facet_wrap( ~ cyl, scales = <span class="string">"free"</span>) <span class="comment"># 这里标度更改为free</span></span><br><span class="line">p + facet_grid(. ~ cyl, scales = <span class="string">"free"</span>, space = <span class="string">"free"</span>)</span><br><span class="line"><span class="comment">#space设置为free时, 每列的宽度 与 该列的标度范围成比例，就是每一个图的宽度与横坐标的范围成正比</span></span><br></pre></td></tr></table></figure>

<h3 id="9-主题"><a href="#9-主题" class="headerlink" title="9.主题"></a>9.主题</h3><p><strong>主题</strong>系统控制着图形中的非数据元素外观, 它不会影响几何对象和标度等数据元素。主题修改是一个对绘图<strong>精雕细琢</strong>的过程, 主要对<strong>标题、坐标轴标签、图例标签</strong>等<strong>文字</strong>调整, 以及<strong>网格线、背景、轴须</strong>的颜色搭配。 </p>
<p>内置元素共有四个基础类型：文本(text), 线条(line)、矩形(rectangle)、空白(blank), text与其他类型操作相类似 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p &lt;- ggplot(mtcars, aes(wt, mpg)) + geom_point() + labs(title = <span class="string">"histogram"</span>)</span><br><span class="line">p + theme(plot.title = element_text(size =<span class="number">20</span>, color = <span class="string">"red"</span>,hjust = <span class="number">0</span>, face = <span class="string">"bold"</span>, angle = <span class="number">180</span>))</span><br><span class="line">p + theme(panel.background = element_blank()) <span class="comment"># 去除背景</span></span><br></pre></td></tr></table></figure>

<h3 id="10-保存输出"><a href="#10-保存输出" class="headerlink" title="10.保存输出"></a>10.保存输出</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p &lt;- ggplot(mtcars, aes(x = mpg, y = disp)) + geom_point()</span><br><span class="line">ggsave( file = <span class="string">"mtcars_plot.png"</span>, width = <span class="number">5</span>, height = <span class="number">6</span>, type = <span class="string">"cairo"</span>, dpi = <span class="number">600</span>) </span><br><span class="line"><span class="comment"># cairo为抗锯齿包, ggplot默认输出即为cairo处理</span></span><br></pre></td></tr></table></figure>

<h4 id="高质量图片输出"><a href="#高质量图片输出" class="headerlink" title="高质量图片输出"></a>高质量图片输出</h4><blockquote>
<p>在ggplot2我比较推荐的图片输出格式为经过Cairo包处理的<strong>PDF</strong>，因为PDF格式体积小，同时可以储存为其他任何格式，随后再将PDF储存为eps格式并在Photoshop中打开做最终的调整，例如调整比例、色彩空间和dpi（一般杂志和出版社要求dpi=300以上）等。额外需要注意的是ggplot2中的字体大小问题，在<a href="http://www.cookbook-r.com/Graphs/Fonts/">cookbook-r</a>一书中指出，在ggplot2中绝大多数情况下，size的大小以<strong>mm</strong>记，详细的讨论也可以参考<a href="http://stackoverflow.com/questions/17311917/ggplot2-the-unit-of-size">stackover的讨论</a>，而在theme()中对element_text()里的size进行调整，此时的size是以<strong>磅值（points, pts）</strong>来进行表示 </p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span>(ggplot2)</span><br><span class="line"><span class="keyword">require</span>(Cairo)</span><br><span class="line">ggplot() +</span><br><span class="line">  geom_text(aes(x = <span class="number">16</span>, y = <span class="number">16</span>), label = <span class="string">"ABC"</span>, size = <span class="number">11.28</span>) + <span class="comment">#尺寸为11.28mm，即为32磅</span></span><br><span class="line">  geom_text(aes(x = <span class="number">16</span>, y = <span class="number">14.5</span>), label = <span class="string">"ABC"</span>, size = <span class="number">32</span>) + <span class="comment">#尺寸为32mm</span></span><br><span class="line">  labs( x = <span class="string">"x axis"</span>, y = <span class="string">"y axis"</span>) +</span><br><span class="line">  ylim( c(<span class="number">14</span>, <span class="number">16.5</span>)) +</span><br><span class="line">  xlim( c(<span class="number">15.75</span>, <span class="number">16.25</span>)) +</span><br><span class="line">  theme(</span><br><span class="line">    axis.title.x = element_text(size = <span class="number">32</span>),<span class="comment">#尺寸为32磅</span></span><br><span class="line">    axis.title.y = element_text(size = <span class="number">32</span>))<span class="comment">#尺寸为32磅</span></span><br><span class="line"> </span><br><span class="line">x &lt;- seq(-<span class="number">4</span>,<span class="number">4</span>, length.out = <span class="number">1000</span>)</span><br><span class="line">y &lt;-dnorm(x)</span><br><span class="line">data &lt;- data.frame(x, y)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#用Cairo包输出</span></span><br><span class="line"><span class="keyword">require</span>(Cairo)</span><br><span class="line">CairoPDF(<span class="string">"plot1.pdf"</span>, <span class="number">3.15</span>, <span class="number">3.15</span>) <span class="comment">#单位为英寸</span></span><br><span class="line">ggplot(data, aes(x = x, y = y)) + geom_line(size = <span class="number">1</span>) +</span><br><span class="line">  theme_bw()</span><br><span class="line">dev.off() <span class="comment">#关闭图像设备，同时储存图片 </span></span><br><span class="line">plot2 &lt;- ggplot(data, aes(x = x, y = y)) + geom_line(size = <span class="number">1</span>) +</span><br><span class="line">  theme_bw()</span><br><span class="line"><span class="comment">#用ggsave输出，默认即以用Cairo包进行抗锯齿处理</span></span><br><span class="line">ggsave(<span class="string">"plot2.pdf"</span>, plot2, width = <span class="number">3.15</span>, height = <span class="number">3.15</span>)</span><br><span class="line"><span class="comment">#RStudio输出</span></span><br></pre></td></tr></table></figure>

<h4 id="中文字体"><a href="#中文字体" class="headerlink" title="中文字体"></a>中文字体</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#showtext</span></span><br><span class="line"><span class="keyword">require</span>(showtext)</span><br><span class="line"><span class="keyword">require</span>(ggplot2)</span><br><span class="line"><span class="keyword">require</span>(Cairo)</span><br><span class="line">font_add(<span class="string">"BlackoakStd"</span>, <span class="string">"C://Windows//Fonts//BlackoakStd.otf"</span>)</span><br><span class="line">font_add(<span class="string">"BrushScriptStd"</span>, <span class="string">"C://Windows//Fonts//BrushScriptStd.otf"</span>)</span><br><span class="line">font_add(<span class="string">"times"</span>, <span class="string">"C://Windows//Fonts//times.ttf"</span>)</span><br><span class="line">font_add(<span class="string">"STHUPO"</span>, <span class="string">"C://Windows//Fonts//STHUPO.ttf"</span>)</span><br><span class="line">CairoPDF(<span class="string">"showtext_output"</span>, <span class="number">8</span>, <span class="number">8</span>)</span><br><span class="line">showtext.begin()</span><br><span class="line">ggplot() +</span><br><span class="line">  geom_text(aes(x = <span class="number">16</span>, y = <span class="number">16.25</span>), label = <span class="string">"Blackoak Std"</span>, size = <span class="number">8</span>,</span><br><span class="line">            family = <span class="string">"BlackoakStd"</span>) +</span><br><span class="line">  geom_text(aes(x = <span class="number">16</span>, y = <span class="number">16</span>), label =<span class="string">"Brush Script Std"</span>, size = <span class="number">16</span>,</span><br><span class="line">            family = <span class="string">"BrushScriptStd"</span>) +</span><br><span class="line">  geom_text(aes(x = <span class="number">16</span>, y = <span class="number">15.75</span>), label = <span class="string">"Times New Roman"</span>, size = <span class="number">16</span>,</span><br><span class="line">            family = <span class="string">"times"</span>) +</span><br><span class="line">  geom_text(aes(x = <span class="number">16</span>, y = <span class="number">15.50</span>), label = <span class="string">"华文琥珀"</span>, size = <span class="number">16</span>,</span><br><span class="line">            family = <span class="string">"STHUPO"</span>) +</span><br><span class="line">  ylim(c(<span class="number">15.25</span>, <span class="number">16.50</span>)) +</span><br><span class="line">  labs(x = <span class="string">""</span>, y = <span class="string">""</span>) +</span><br><span class="line">  theme_bw() <span class="comment">#在用RStudio输出</span></span><br></pre></td></tr></table></figure>

<h2 id="BTW-补充知识"><a href="#BTW-补充知识" class="headerlink" title="BTW 补充知识"></a>BTW 补充知识</h2><p>参考 <a href="https://blog.csdn.net/u014801157/article/category/2215813">金子哦ggplot2</a> 系列教程</p>
<h3 id="1-从例子中学理论"><a href="#1-从例子中学理论" class="headerlink" title="1.从例子中学理论"></a>1.从例子中学理论</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">length(ggplot())</span><br><span class="line">names(ggplot())</span><br><span class="line">str(ggplot())</span><br><span class="line">ggplot()$data</span><br><span class="line"></span><br><span class="line">p &lt;- ggplot(diamonds) + geom_point() + aes(x=carat, y=price, color = color, shape= cut)</span><br><span class="line">p$layers</span><br></pre></td></tr></table></figure>

<p>一个图层包含了至少3个东西（数据和映射当然必需，另算）：geom、stat和position</p>
<ul>
<li>几何类型 geom：是数据在图上的展示形式，即点、线、面等。在ggplot2里面有很多预定义的几何类型。</li>
<li>统计类型 stat：是对数据所应用的统计类型/方法。上面的p2和p3对象我们并没有指定统计类型，但是自动获得了identity，因为ggplot2为每一种几何类型指定了一种默认的统计类型，反之亦然。所以如果仅指定geom或stat中的一个，另外一个会自动获取。</li>
<li>位置 position：几何对象在图像上的位置调整，这也有默认设定。</li>
</ul>
<p>图层加法 = 图层按照顺序的叠加</p>
<h3 id="2-映射-1"><a href="#2-映射-1" class="headerlink" title="2.映射"></a>2.映射</h3><p>ggplot2按照图形属性提供了以下可用映射类型：</p>
<ul>
<li>颜色类型映射：包括 color（颜色或边框颜色）、fill（填充颜色）和 alpha（透明度）</li>
<li>形状类型映射：包括 linetype（线型）、size（点的大小或线的宽度）和 shape（形状）</li>
<li>位置类型映射：包括 x, y, xmin, xmax, ymin, ymax, xend, yend</li>
<li>特殊类型：包括两类，一类是指定数据分组和顺序的映射group和order，另一类是字符串映射。</li>
</ul>
<p>ggplot2对映射应用的标尺可以修改，ggplot提供了一大批 scale_xxxxxxxx 类型的函数，比如 scale_color_xxxx 类型函数用户修改颜色标尺，scale_shape_xxxx 修改形状，scale_linetype_xxxx 修改线型等。按照数据的类型，这些函数还有4种基本类型：</p>
<ul>
<li>continuous：连续型</li>
<li>discrete：离散型</li>
<li>identity：和数据取值相同</li>
<li>manual：手工指定</li>
</ul>
<p>映射会自动产生<strong>图例</strong></p>
<h4 id="非映射-即-设定"><a href="#非映射-即-设定" class="headerlink" title="非映射 即 设定"></a>非映射 即 设定</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p  + geom_boxplot(aes(x=cut, fill=cut)) +</span><br><span class="line">  scale_fill_manual(values=rep(<span class="string">"cyan"</span>, length(levels(d.sub$cut))))</span><br><span class="line">p  + geom_boxplot(aes(x=cut), fill=<span class="string">"cyan"</span>) </span><br><span class="line"><span class="comment"># 设定没有图例，而且 fill="cyan"不在 aes()里面</span></span><br></pre></td></tr></table></figure>

<p>ymin/ymax 可以画出 带有误差线的散点图，无需使用errorbar设置</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dmod &lt;- lm(price ~ cut, data = diamonds)</span><br><span class="line">cuts &lt;- data.frame(cut = unique(diamonds$cut), predict(dmod, data.frame(cut =</span><br><span class="line">unique(diamonds$cut)), se = <span class="literal">TRUE</span>)[c(<span class="string">"fit"</span>, <span class="string">"se.fit"</span>)])</span><br><span class="line">se &lt;- ggplot(cuts, aes(x = cut, y = fit, ymin = fit - se.fit, ymax = fit + se.fit, colour = cut))</span><br><span class="line">se + geom_pointrange()</span><br><span class="line"><span class="comment"># 或者像这样</span></span><br><span class="line">se + geom_point() + geom_errorbar(width=<span class="number">0.2</span>)</span><br><span class="line">se + geom_bar(stat=<span class="string">"identity"</span>, aes(fill=cut)) + geom_errorbar(width=<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure>

<p>在ggplot2作图过程中，映射的处理在先于其他绘图步骤，也先于统计运算。颜色和形状类型的映射会对数据进行分组，统计运算使用的也是分组后的数据。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot(d.sub, aes(x=carat, y=price, color=cut)) +</span><br><span class="line">  geom_point() + geom_smooth(aes(group=<span class="number">1</span>), method=<span class="string">"lm"</span>, se=<span class="literal">FALSE</span>)</span><br><span class="line"><span class="comment"># 本来按cut分组后的数据恢复为1组来进行回归计算</span></span><br><span class="line">ggplot(d.sub, aes(x=carat, y=price, color=cut)) + geom_point() +</span><br><span class="line">  geom_smooth(aes(group=color, linetype=color), method=<span class="string">"lm"</span>, se=<span class="literal">FALSE</span>, color=<span class="string">"black"</span>)</span><br><span class="line"><span class="comment"># 在回归统计分析中重新按照color来对数据分组，并映射为线条类</span></span><br></pre></td></tr></table></figure>

<p>不同图形对X轴数据类型的要求是不一样的，曲线图要用连续型数据，而柱形图要用因子型（或离散型）数据，这两类图形如果不经特殊处理就不能放在一起。group映射可以轻松搞定它 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">se + geom_bar(stat=<span class="string">"identity"</span>, aes(fill=cut)) + geom_errorbar(width=<span class="number">0.2</span>) +</span><br><span class="line">  coord_cartesian(ylim=c(<span class="number">3000</span>,<span class="number">4800</span>)) + geom_line(aes(group=<span class="number">1</span>), color=<span class="string">"black"</span>)</span><br><span class="line"><span class="comment"># group重新将数据整合为1组来画折线图</span></span><br></pre></td></tr></table></figure>

<p>order映射用于改变数据类型的排序。注意是在图层中的排列顺序而不是图例的先后顺序 ，也就是颜色的叠加顺序</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p + geom_point(aes(color=cut, order=cut))</span><br><span class="line"><span class="keyword">library</span>(plyr) <span class="comment"># 使用desc函数</span></span><br><span class="line">p + geom_point(aes(color=cut, order=desc(cut)))</span><br></pre></td></tr></table></figure>

<h3 id="ggplot2作图详解4：分面"><a href="#ggplot2作图详解4：分面" class="headerlink" title="ggplot2作图详解4：分面"></a>ggplot2作图详解4：分面</h3><p>facet_wrap</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line"><span class="comment"># 准备数据</span></span><br><span class="line">set.seed(<span class="number">100</span>) <span class="comment"># 产生随机编号，在取随机数之前必做，保证每个人取到的随机数是相同的</span></span><br><span class="line">d.sub &lt;- diamonds[sample(nrow(diamonds), <span class="number">500</span>), ]</span><br><span class="line">head(d.sub, <span class="number">4</span>)</span><br><span class="line">theme_set(theme_bw())</span><br><span class="line">p  &lt;- ggplot(data=d.sub, aes(x=carat, y=price))</span><br><span class="line">p + geom_point() + facet_wrap(~cut)</span><br><span class="line"></span><br><span class="line"><span class="comment"># usage</span></span><br><span class="line">facet_wrap(facets, nrow = <span class="literal">NULL</span>, ncol = <span class="literal">NULL</span>, scales = <span class="string">"fixed"</span>, shrink = <span class="literal">TRUE</span>, as.table = <span class="literal">TRUE</span>, drop = <span class="literal">TRUE</span>)</span><br><span class="line"><span class="comment"># shrinks：也和坐标轴刻度有关，如果为TRUE（默认值）则按统计后的数据调整刻度范围，否则按统计前的数据设定坐标</span></span><br><span class="line"><span class="comment"># as.table：和小图排列顺序有关的选项。如果为TRUE（默认）则按表格方式排列，即最大值（指分组level值）排在表格最后即右下角，否则排在左上角</span></span><br><span class="line"><span class="comment"># drop：是否丢弃没有数据的分组，如果为TRUE（默认），则空数据组不绘图</span></span><br></pre></td></tr></table></figure>

<p>facet_grid</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># usage</span></span><br><span class="line">facet_grid(facets, margins = <span class="literal">FALSE</span>, scales = <span class="string">"fixed"</span>, space = <span class="string">"fixed"</span>, shrink = <span class="literal">TRUE</span>, labeller = <span class="string">"label_value"</span>, as.table = <span class="literal">TRUE</span>, drop = <span class="literal">TRUE</span>)</span><br><span class="line"><span class="comment"># example</span></span><br><span class="line">qplot(carat, price, data=diamonds, alpha=I(<span class="number">0.2</span>)) + facet_grid(color~cut, margins=<span class="literal">TRUE</span>)</span><br><span class="line"><span class="comment"># color~cut 对数据的分组和小图排列有决定作用，波浪号前为小图分 行标准，后面为分 列标准，因此不同设置行/列数</span></span><br><span class="line"><span class="comment"># margins为T时会增加一行数据和一列数据，所有行数据整合叠加在一起，所有列数据整合叠加在一起。</span></span><br></pre></td></tr></table></figure>

<h3 id="图形语法和图形组合"><a href="#图形语法和图形组合" class="headerlink" title="图形语法和图形组合"></a>图形语法和图形组合</h3><h4 id="1-几何-统计类型设置函数"><a href="#1-几何-统计类型设置函数" class="headerlink" title="1.几何/统计类型设置函数"></a>1.几何/统计类型设置函数</h4><p>在ggplot2中，每种几何类型都有对应的（默认）统计类型，反之亦然。两者不分家，所以得放在一起来说。换言之，一般只需要设置其中一个，另一个会设置为对应的（默认）统计类型。几何类型的设置函数全部为geom_xxx形式，而统计类型设置函数全部为stat_xxx的形式 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可通过一下代码查看</span></span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">ls(<span class="string">"package:ggplot2"</span>, pattern=<span class="string">"^geom_.+"</span>)</span><br><span class="line">ls(<span class="string">"package:ggplot2"</span>, pattern=<span class="string">"^stat_.+"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># usage</span></span><br><span class="line">geom_point(mapping = <span class="literal">NULL</span>, data = <span class="literal">NULL</span>, stat = <span class="string">"identity"</span>,</span><br><span class="line">           position = <span class="string">"identity"</span>, na.rm = <span class="literal">FALSE</span>, <span class="keyword">...</span>)</span><br><span class="line">stat_identity(mapping = <span class="literal">NULL</span>, data = <span class="literal">NULL</span>, geom = <span class="string">"point"</span>,</span><br><span class="line">              position = <span class="string">"identity"</span>, width = <span class="literal">NULL</span>,</span><br><span class="line">              height = <span class="literal">NULL</span>, <span class="keyword">...</span>)</span><br><span class="line"><span class="comment"># ggplot(data,aes())data参数在前，mapping参数在后，而geom/stat是mapping在前，可以不用参数，因为作图前数据都已确定</span></span><br><span class="line"></span><br><span class="line">set.seed(<span class="number">100</span>)</span><br><span class="line">d.sub &lt;- diamonds[sample(nrow(diamonds), <span class="number">500</span>),]</span><br><span class="line">p &lt;- ggplot(d.sub, aes(x=carat, y=price))</span><br><span class="line">theme_set(theme_bw())</span><br><span class="line">p + stat_identity()</span><br><span class="line">p + geom_point()</span><br><span class="line"><span class="comment"># 两个是一样的，因为 geom_point()对应的统计类型就是 stat_identity()</span></span><br></pre></td></tr></table></figure>

<p>具体二者对应信息参考<a href="http://www.omicsclass.com/article/407">组学大讲堂</a></p>
<p><strong>Btw</strong>： 有些数据包只有特定的R包才会内置，而有些是R自带的基础包</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data() <span class="comment"># 查看自带的包</span></span><br><span class="line">data(package = .packages(all.available = <span class="literal">T</span>)) <span class="comment"># 查看R包自带的数据集</span></span><br></pre></td></tr></table></figure>

<h4 id="2-图层组合"><a href="#2-图层组合" class="headerlink" title="2.图层组合"></a>2.图层组合</h4><blockquote>
<p>图层的组合不是连续使用几个几何或统计类型函数那么简单。ggplot函数可以设置数据和映射，每个图层设置函数（geom_xxx和stat_xxx）也都可以设置数据和映射 </p>
</blockquote>
<h5 id="2-1简单组合"><a href="#2-1简单组合" class="headerlink" title="2.1简单组合"></a>2.1简单组合</h5><p>不同图层使用同一套数据，只是几何类型或统计类型有差别。这是最简单也是最常用的，用ggplot函数设置好数据和映射，把几个图层加起来即可。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">datax &lt;- data.frame(x=<span class="number">1</span>:<span class="number">10</span>, y=rnorm(<span class="number">10</span>)+<span class="number">1</span>:<span class="number">10</span>)</span><br><span class="line">p  &lt;- ggplot(datax, aes(x=x, y=y))</span><br><span class="line">p + geom_point() + geom_line()</span><br><span class="line">p + geom_point() + geom_smooth(method=<span class="string">"lm"</span>)</span><br></pre></td></tr></table></figure>

<p>ggplot2的图层设置函数对映射的数据类型是有较严格要求的，比如geom_point和geom_line函数要求x映射的数据类型为数值向量，而geom_bar函数要使用因子型数据。如果数据类型不符合映射要求就得做类型转换，在组合图形时还得注意图层的先后顺序。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p  &lt;- ggplot(datax, aes(x=factor(x), y=y)) + xlab(<span class="string">"x"</span>)</span><br><span class="line">p + geom_bar(stat=<span class="string">"identity"</span>, fill=<span class="string">"gray"</span>) +</span><br><span class="line">  geom_line(aes(group=<span class="number">1</span>), size=<span class="number">2</span>) + geom_point(color=<span class="string">"red"</span>)</span><br><span class="line">p + geom_bar(stat=<span class="string">"identity"</span>, fill=<span class="string">"gray"</span>) +</span><br><span class="line">  geom_smooth(aes(group=<span class="number">1</span>), method=<span class="string">"lm"</span>, se=<span class="literal">FALSE</span>, size=<span class="number">2</span>) <span class="comment"># 先做barplot（因子型），再做散点图（连续性数值向量）</span></span><br></pre></td></tr></table></figure>

<h5 id="2-2不同映射组合"><a href="#2-2不同映射组合" class="headerlink" title="2.2不同映射组合"></a>2.2不同映射组合</h5><pre><code> 映射反映的是数据变量。多数情况下一个图形中使用的是同一个数据集，只是变量不同。通常情况下x，y轴至少有一个是相同的，可以用不同图层叠加不同的数据变量 ，明智的办法是`reshape2`中的`melt()`变形数据，将不同变量移到同一列作为因子型</code></pre>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p &lt;- ggplot(d.sub, aes(x=carat)) + ylab(<span class="string">"depth (blue) / table (red)"</span>)</span><br><span class="line">p + geom_point(aes(y=depth), color=<span class="string">"blue"</span>)  +</span><br><span class="line">  geom_point(aes(y=table), color=<span class="string">"red"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 明智之举</span></span><br><span class="line"><span class="keyword">library</span>(reshape2)</span><br><span class="line">datax &lt;-melt(d.sub, id.vars=<span class="string">"carat"</span>, measure.vars=c(<span class="string">"depth"</span>, <span class="string">"table"</span>))</span><br><span class="line">ggplot(datax, aes(x=carat, y=value, color=variable)) + geom_point()</span><br></pre></td></tr></table></figure>

<h5 id="2-3-不同类型数据的组合"><a href="#2-3-不同类型数据的组合" class="headerlink" title="2.3 不同类型数据的组合"></a>2.3 不同类型数据的组合</h5><blockquote>
<p>如果在geom_xxx函数中改变数据会怎么样呢？不同类型的数据一般不会有完全相同的变量，否则就不是“不同类型”了，所以映射也会相应做修改。下面把钻石数据diamonds和汽车数据mtcars这两个风牛马不相及的数据放在一起看看 </p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">data(mtcars)</span><br><span class="line">p &lt;- ggplot(data=d.sub, aes(x=carat, y=price, color=cut)) <span class="comment"># diamonds数据</span></span><br><span class="line">layer1 &lt;- geom_point(aes(x=carb, y=mpg), mtcars, color=<span class="string">"black"</span>) <span class="comment"># mtcars数据</span></span><br><span class="line">p1 &lt;- p + layer1</span><br><span class="line"><span class="comment"># 图中数据点是正确的，但坐标轴标题却对不上号。看看ggplot对象的数据、映射和图层；</span></span><br><span class="line">head(p1$data,<span class="number">4</span>)</span><br><span class="line">p1$mapping</span><br><span class="line">p1$layers</span><br><span class="line"><span class="comment"># 数据和映射都还是ggplot原来设置的样子，layer2图层设置的都没有存储到ggplot图形列表对象的data和mapping元素中，而是放在了图层中，但图层中设定的数据不知道跑哪里。如果再增加一个图层，把坐标轴标题标清楚：</span></span><br><span class="line">layer2 &lt;- geom_point(aes(y=depth))</span><br><span class="line">p1 &lt;- p1 + layer2 + xlab(<span class="string">"carb(black) / carat"</span>) + ylab(<span class="string">"mpg(black) / depth"</span>)</span><br><span class="line"><span class="comment"># layer2重新指定了y映射，但没碰原来ggplot对象设置的x和color映射，从获得的图形来看y数据改变了，x和color还是原ggplot对象的设置。查看一下映射和图层</span></span><br><span class="line">p1$mapping</span><br><span class="line">p1$layers</span><br><span class="line"><span class="comment"># 可以这么理解：ggplot2图层作图时依次从ggplot对象和图层中获取数据/映射，如果两者映射有重叠，后者将替换前者，但只是在该图层中进行替换而不影响ggplot对象。</span></span><br><span class="line"><span class="comment"># 如果ggplot对象的映射比图层的映射多，而图层又使用了不同的数据，这是什么情况？看看</span></span><br><span class="line">p + geom_point(aes(x=carb, y=mpg), mtcars)</span><br><span class="line"><span class="comment"># 由于图层继承了ggplot对象的color映射，但又找不到数据，所以没法作图。解决办法是把原有的映射用NULL取代，或者设为常量（非映射）</span></span><br><span class="line">p + geom_point(aes(x=carb, y=mpg, color=<span class="literal">NULL</span>), mtcars)</span><br><span class="line">p + geom_point(aes(x=carb, y=mpg), mtcars, color=<span class="string">"red"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="标度（scale）设置"><a href="#标度（scale）设置" class="headerlink" title="标度（scale）设置"></a>标度（scale）设置</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">scalex &lt;- ls(<span class="string">"package:ggplot2"</span>,pattern = <span class="string">"^scale.+"</span>)</span><br><span class="line">scalex &lt;- scalex[grep(<span class="string">"([^_]+_)&#123;2&#125;.+"</span>, scalex)]</span><br><span class="line">unique(gsub(<span class="string">"(([^_]+_)&#123;2&#125;).+"</span>,<span class="string">"\\1***"</span>,scalex))</span><br><span class="line"><span class="comment"># 可以看到标尺设置的内容有8种（颜色color/colour算一种）：线条颜色、填充色、透明度、线型、形状、大小，x和y轴。</span></span><br><span class="line"><span class="comment"># 标尺设置的内容都有对应的映射设置类型，但映射比标尺多了xmin, xmax, ymin, ymax, xend, yend，group和string等</span></span><br><span class="line"><span class="comment"># 线条颜色</span></span><br><span class="line">scalexx &lt;- scalex[grepl(<span class="string">"scale_color.+"</span>, scalex)]</span><br><span class="line">unique(gsub(<span class="string">"(([^_]+_)&#123;2&#125;)(.+)"</span>,<span class="string">"\\3"</span>,scalexx))</span><br><span class="line"><span class="comment">##  [1] "brewer"     "continuous" "discrete"   "gradient"   "gradient2" </span></span><br><span class="line"><span class="comment">##  [6] "gradientn"  "grey"   "hue"   "identity"   "manual" "viridis_c"  "viridis_d" </span></span><br><span class="line"><span class="comment"># 填充色</span></span><br><span class="line">scalexx &lt;- scalex[grepl(<span class="string">"scale_fill.+"</span>, scalex)]</span><br><span class="line">unique(gsub(<span class="string">"(([^_]+_)&#123;2&#125;)(.+)"</span>,<span class="string">"\\3"</span>,scalexx))</span><br><span class="line"><span class="comment">##  [1] "brewer"     "continuous" "discrete"   "gradient"   "gradient2" </span></span><br><span class="line"><span class="comment">##  [6] "gradientn"  "grey"       "hue"        "identity"   "manual" "ordinal"  "viridis_c"  "viridis_d"</span></span><br><span class="line"><span class="comment"># 大小</span></span><br><span class="line">scalexx &lt;- scalex[grepl(<span class="string">"scale_size.+"</span>, scalex)]</span><br><span class="line">unique(gsub(<span class="string">"(([^_]+_)&#123;2&#125;)(.+)"</span>,<span class="string">"\\3"</span>,scalexx))</span><br><span class="line"><span class="comment">## [1] "area"  "continuous" "discrete"   "identity"   "manual" "ordinal"   </span></span><br><span class="line"><span class="comment"># 透明度</span></span><br><span class="line">scalexx &lt;- scalex[grepl(<span class="string">"scale_alpha.+"</span>, scalex)]</span><br><span class="line">unique(gsub(<span class="string">"(([^_]+_)&#123;2&#125;)(.+)"</span>,<span class="string">"\\3"</span>,scalexx))</span><br><span class="line"><span class="comment">## [1] "continuous" "discrete"   "identity"   "manual"  "ordinal"  </span></span><br><span class="line"><span class="comment"># 线型</span></span><br><span class="line">scalexx &lt;- scalex[grepl(<span class="string">"scale_linetype.+"</span>, scalex)]</span><br><span class="line">unique(gsub(<span class="string">"(([^_]+_)&#123;2&#125;)(.+)"</span>,<span class="string">"\\3"</span>,scalexx))</span><br><span class="line"><span class="comment">## [1] "continuous" "discrete"   "identity"   "manual"</span></span><br><span class="line"><span class="comment"># 形状</span></span><br><span class="line">scalexx &lt;- scalex[grepl(<span class="string">"scale_shape.+"</span>, scalex)]</span><br><span class="line">unique(gsub(<span class="string">"(([^_]+_)&#123;2&#125;)(.+)"</span>,<span class="string">"\\3"</span>,scalexx))</span><br><span class="line"><span class="comment">## [1] "continuous" "discrete"   "identity"   "manual" "ordinal"</span></span><br><span class="line"><span class="comment"># x轴</span></span><br><span class="line">scalexx &lt;- scalex[grepl(<span class="string">"scale_x.+"</span>, scalex)]</span><br><span class="line">unique(gsub(<span class="string">"(([^_]+_)&#123;2&#125;)(.+)"</span>,<span class="string">"\\3"</span>,scalexx))</span><br><span class="line"><span class="comment">## [1] "continuous" "date"       "datetime"   "discrete"   "log10"  </span></span><br><span class="line"><span class="comment">## [6] "reverse"    "sqrt"  "time"</span></span><br><span class="line"><span class="comment"># y轴</span></span><br><span class="line">scalexx &lt;- scalex[grepl(<span class="string">"scale_y.+"</span>, scalex)]</span><br><span class="line">unique(gsub(<span class="string">"(([^_]+_)&#123;2&#125;)(.+)"</span>,<span class="string">"\\3"</span>,scalexx))</span><br><span class="line"><span class="comment">## [1] "continuous" "date"  "datetime"   "discrete"   "log10"     </span></span><br><span class="line"><span class="comment">## [6] "reverse"    "sqrt" "time"</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>除坐标轴外，其它标尺都有四种基本设置函数：”continuous”，”discrete”，”identity”和”manual”。结合标尺的作用和设定方法两个标准，H.W把它们分为4种类型的标尺：位置、颜色、无变换和人工设置类型（详情参考相关书籍）。颜色设置相关的函数较多，线条颜色和填充色设置的函数类型基本一致，而x轴和y轴设置的函数类型也一样</p>
</blockquote>
<p>例子举了 颜色标尺 和 坐标轴标尺，在这里就不细说了，直接参考<a href="https://blog.csdn.net/u014801157/article/details/24372521">原帖</a>。</p>
<h3 id="主题-theme-设置"><a href="#主题-theme-设置" class="headerlink" title="主题(theme)设置"></a>主题(theme)设置</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">theme_gray()</span><br><span class="line"><span class="comment"># 所有元素都在theme函数内使用element_line，element_rect，element_text和element_blank函数设置</span></span><br><span class="line">x &lt;- LETTERS[<span class="number">1</span>:<span class="number">10</span>]; y &lt;- abs(rnorm(<span class="number">10</span>))</span><br><span class="line">p &lt;- qplot(x=x, y=y, color=x, fill=x, geom=c(<span class="string">'line'</span>,<span class="string">'point'</span>), group=<span class="number">1</span>) +</span><br><span class="line">  labs(title=<span class="string">'The figure title.'</span>, xlab=<span class="string">'Factor'</span>, ylab=<span class="string">'Value'</span>) +</span><br><span class="line">  theme(text=element_text(color=<span class="string">'red'</span>, size=<span class="number">16</span>),</span><br><span class="line">        line=element_line(color=<span class="string">'blue'</span>),</span><br><span class="line">        rect=element_rect(fill=<span class="string">'white'</span>))</span><br><span class="line">p + theme(panel.background=element_rect(fill=<span class="string">'transparent'</span>, color=<span class="string">'gray'</span>),</span><br><span class="line">          legend.key=element_rect(fill=<span class="string">'transparent'</span>, color=<span class="string">'transparent'</span>),</span><br><span class="line">          axis.text=element_text(color=<span class="string">'red'</span>))</span><br><span class="line"><span class="comment"># 全局text和rect设置对部分元素有作用，line基本不起作用</span></span><br></pre></td></tr></table></figure>

<h5 id="自定义主题"><a href="#自定义主题" class="headerlink" title="自定义主题"></a>自定义主题</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##' A nice-looking ggplot2 theme: inward axis ticks, legend title excluded, and uniform background.</span></span><br><span class="line"><span class="comment">##' @title A nice-looking ggplot2 theme</span></span><br><span class="line"><span class="comment">##' @param ...</span></span><br><span class="line"><span class="comment">##' Parameters passed to theme_classic() function.</span></span><br><span class="line"><span class="comment">##' @param bg</span></span><br><span class="line"><span class="comment">##' Color string (default 'white') for user defined uniform background.</span></span><br><span class="line"><span class="comment">##' @return</span></span><br><span class="line"><span class="comment">##' ggplot2 theme object.</span></span><br><span class="line"><span class="comment">##' @example</span></span><br><span class="line"><span class="comment">##' library(ggplot2)</span></span><br><span class="line"><span class="comment">##' qplot(x=carat, y=price, color=cut, data=diamonds) + theme_zg()</span></span><br><span class="line"><span class="comment">##' @author ZG Zhao</span></span><br><span class="line"><span class="comment">##' @export</span></span><br><span class="line">theme_zg &lt;- <span class="keyword">function</span>(<span class="keyword">...</span>, bg=<span class="string">'white'</span>)&#123;</span><br><span class="line">    <span class="keyword">require</span>(grid)</span><br><span class="line">    theme_classic(<span class="keyword">...</span>) +</span><br><span class="line">        theme(rect=element_rect(fill=bg),</span><br><span class="line">              plot.margin=unit(rep(<span class="number">0.5</span>,<span class="number">4</span>), <span class="string">'lines'</span>),</span><br><span class="line">              panel.background=element_rect(fill=<span class="string">'transparent'</span>, color=<span class="string">'black'</span>),</span><br><span class="line">              panel.border=element_rect(fill=<span class="string">'transparent'</span>, color=<span class="string">'transparent'</span>),</span><br><span class="line">              panel.grid=element_blank(),</span><br><span class="line">              axis.title = element_text(color=<span class="string">'black'</span>, vjust=<span class="number">0.1</span>),</span><br><span class="line">              axis.ticks.length = unit(-<span class="number">0.4</span>,<span class="string">"lines"</span>),</span><br><span class="line">              axis.ticks = element_line(color=<span class="string">'black'</span>),</span><br><span class="line">              axis.ticks.margin = unit(<span class="number">0.8</span>,<span class="string">"lines"</span>),</span><br><span class="line">              legend.title=element_blank(),</span><br><span class="line">              legend.key=element_rect(fill=<span class="string">'transparent'</span>, color=<span class="string">'transparent'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Your name"></figure><p class="title is-size-4 is-block line-height-inherit">Your name</p><p class="is-size-6 is-block">Your title</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Your location</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">1</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-15T12:40:51.000Z">2020-08-15</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/15/ggplot2/">ggplot2 基础理论知识</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-08T08:57:01.471Z">2020-08-08</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/08/hello-world/">Hello World</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/R/"><span class="tag">R</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Taotao&#039;s Blog" height="28"></a><p class="size-small"><span>&copy; 2020 Shebt</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>